name: Continuous Integration

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main, develop ]

jobs:
  lint-docs:
    name: Lint Documentation
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
      
      - name: Install markdownlint-cli
        run: npm install -g markdownlint-cli
      
      - name: Lint markdown files
        run: |
          # Lint all markdown files in the repository
          # Ignore certain directories that may have auto-generated or third-party markdown
          markdownlint '**/*.md' \
            --ignore node_modules \
            --ignore .git \
            --config .markdownlint.json || true
      
      - name: Check for broken links in documentation
        run: |
          echo "Checking for broken internal links in markdown files..."
          # This is a basic check - you can enhance it with tools like markdown-link-check
          find . -name "*.md" -type f ! -path "./node_modules/*" ! -path "./.git/*" | while read file; do
            echo "Checking $file"
            # Add link checking logic here if desired
          done
      
      - name: Validate documentation structure
        run: |
          echo "Validating documentation structure..."
          # Check that key documentation files exist
          required_files=(
            "README.md"
            "ARCHITECTURE.md"
            "CONTRIBUTING.md"
            "LICENSE"
            "CHANGELOG.md"
          )
          
          for file in "${required_files[@]}"; do
            if [ ! -f "$file" ]; then
              echo "ERROR: Required documentation file missing: $file"
              exit 1
            else
              echo "✓ Found: $file"
            fi
          done
          
          echo "✓ All required documentation files present"

  asset-validation:
    name: Validate Unreal Assets
    # This job requires a self-hosted runner with Unreal Engine installed
    # It serves as a template and placeholder for future CI expansion
    runs-on: self-hosted
    
    # Only run on main branch to avoid unnecessary resource usage
    if: github.ref == 'refs/heads/main'
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Validate asset naming conventions
        run: |
          echo "Validating asset naming conventions..."
          echo "Note: This is a placeholder job that requires Unreal Engine to be installed."
          echo "The AdastreaAssetValidator.py script needs to run within Unreal Editor's Python environment."
          echo ""
          echo "To use this validator:"
          echo "1. Install Unreal Engine on a self-hosted runner"
          echo "2. Enable the Python Editor Script Plugin"
          echo "3. Configure the runner to execute Unreal Python commands"
          echo "4. Update this job to invoke the validator within the Unreal Editor context"
          echo ""
          echo "Current validator configuration can be found in validator_config.json"
      
      - name: Check validator configuration
        run: |
          if [ -f "validator_config.json" ]; then
            echo "✓ Validator configuration file found"
            echo "Configuration version:"
            grep -E '"version"' validator_config.json || echo "Version not specified"
          else
            echo "ERROR: validator_config.json not found"
            exit 1
          fi
      
      - name: Display validation rules
        run: |
          echo "Asset validation rules are configured in validator_config.json"
          echo "Run AdastreaAssetValidator.py in Unreal Editor to perform full validation"
          echo ""
          echo "Supported validations:"
          echo "  - Faction Data Assets"
          echo "  - Spaceship Data Assets"
          echo "  - Personnel Data Assets"
          echo "  - Blueprint Assets"
          echo "  - Material Assets"
          echo "  - Texture Assets"

  # Uncomment and configure these jobs when self-hosted runners are available:
  # Required environment setup for runners:
  #   - Install Unreal Engine 5.6
  #   - Set UE_ROOT environment variable to UE installation path (e.g., "C:\Program Files\Epic Games\UE_5.6")
  #   - Ensure build tools are available (Visual Studio on Windows, Xcode on Mac, build-essential on Linux)
  #
  # build-windows:
  #   name: Build Windows (Development Editor)
  #   runs-on: self-hosted
  #   # Requires: Windows runner with UE 5.6 installed and UE_ROOT environment variable set
  #   
  #   steps:
  #     - name: Checkout code
  #       uses: actions/checkout@v4
  #     
  #     - name: Build Project
  #       run: |
  #         .\build_windows.bat
  #       shell: cmd
  #     
  #     - name: Upload Build Logs
  #       if: always()
  #       uses: actions/upload-artifact@v4
  #       with:
  #         name: build-logs-windows
  #         path: Saved/Logs/
  #
  # build-linux:
  #   name: Build Linux (Development Editor)
  #   runs-on: self-hosted
  #   # Requires: Linux runner with UE 5.6 installed
  #   
  #   steps:
  #     - name: Checkout code
  #       uses: actions/checkout@v4
  #     
  #     - name: Build Project
  #       run: |
  #         ./build_unix.sh
  #     
  #     - name: Upload Build Logs
  #       if: always()
  #       uses: actions/upload-artifact@v4
  #       with:
  #         name: build-logs-linux
  #         path: Saved/Logs/
  #
  # For detailed build configuration and CI/CD integration examples,
  # see UNREAL_BUILD_GUIDE.md
  #
  # Future jobs can be added:
  # - cpp-lint: C++ code style checking with clang-format
  # - cpp-static-analysis: Static analysis with clang-tidy or cppcheck
  # - unit-tests: C++ unit tests
  # - integration-tests: Unreal automation tests
